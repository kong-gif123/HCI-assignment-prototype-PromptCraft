<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft - Professional Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF;
            color: #111827;
            -webkit-font-smoothing: antialiased;
        }

        /* --- UI COMPONENTS --- */
        
        /* Sliders */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #E5E7EB;
            border-radius: 2px;
        }
        
        /* Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animations */
        .log-fade { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        
        .bar-fill { transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); }
        
        .fade-in-panel { animation: panelFade 0.3s ease-out; }
        @keyframes panelFade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .dropdown-enter-active { animation: slide-in 0.2s ease-out forwards; }
        @keyframes slide-in { from { opacity: 0; transform: translateY(-8px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* Utilities */
        textarea::-webkit-scrollbar { width: 6px; }
        textarea::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb { background-color: #E5E7EB; border-radius: 3px; }
        
        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #10B981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10B981; }
        
        /* Error Shake Animation (Visual Feedback for Errors) */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-white" onclick="closeDropdowns(event)">

    <!-- HEADER -->
    <header class="h-20 flex items-center justify-between px-8 lg:px-12 bg-white sticky top-0 z-50 shadow-sm border-b border-gray-50">
        <div class="flex items-center cursor-pointer" onclick="window.location.reload()">
            <span class="text-xl font-bold tracking-tight text-black">PromptCraft</span>
        </div>

        <div class="flex items-center gap-4">
            <button class="text-sm text-gray-500 hover:text-black font-medium transition-colors px-2">Home</button>
            <button class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 text-gray-500 hover:bg-gray-50 hover:text-black transition-all">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
            </button>

            <!-- AUDIO MENU -->
            <div class="relative">
                <button id="audio-menu-btn" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 text-gray-500 hover:bg-gray-50 hover:text-black transition-all relative z-10 bg-white">
                    <svg id="header-icon-on" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                    <svg id="header-icon-off" class="hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="1" x2="1" y2="23"/></svg>
                </button>
                <div id="audio-dropdown" class="hidden absolute right-0 mt-3 w-72 bg-white rounded-2xl shadow-xl border border-gray-100 ring-1 ring-black ring-opacity-5 z-50 p-4">
                    <div class="flex items-center justify-between mb-4 pb-3 border-b border-gray-100">
                        <div><h3 class="text-sm font-bold text-gray-900">Audio Feedback</h3><p class="text-[10px] text-gray-500 uppercase">Standard Web API</p></div>
                        <div class="flex items-center gap-1"><span class="text-[10px] font-bold text-gray-400" id="audio-status-text">Disabled</span><div class="h-2 w-2 rounded-full bg-gray-300" id="audio-status-dot"></div></div>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-gray-700 font-medium">Enable Sounds</span>
                        <div class="relative inline-block w-10 align-middle select-none"><input type="checkbox" id="sound-toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 checked:border-green-500 transition-all duration-300 left-0 top-0"/><label for="sound-toggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"></label></div>
                    </div>
                    <!-- Demo Button -->
                    <button id="test-audio-btn" class="w-full py-2.5 bg-gray-50 hover:bg-gray-100 text-gray-800 rounded-xl text-sm font-semibold transition-all flex items-center justify-center gap-2 border border-gray-200 active:scale-95"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>Test Sound</button>
                    <p class="text-[10px] text-gray-400 mt-2 text-center italic">Preference saved to localStorage</p>
                </div>
            </div>
            <button class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 text-gray-500 hover:bg-gray-50 hover:text-black transition-all"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></button>
        </div>
    </header>

    <!-- SUB-HEADER & MODE SWITCHER -->
    <div class="px-8 lg:px-12 py-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div class="bg-gray-100 rounded-full p-1 inline-flex self-start relative">
            <button id="mode-quick" class="w-32 py-2 rounded-full bg-black text-white text-sm font-semibold shadow-sm transition-all z-10">Quick Mode</button>
            <button id="mode-builder" class="w-32 py-2 rounded-full text-gray-500 hover:text-gray-900 text-sm font-medium transition-all z-10">Builder</button>
        </div>
        
        <div class="flex items-center space-x-8 text-xs font-medium self-end md:self-auto pt-2 md:pt-0">
            <span class="text-gray-400">Model: <span class="text-gray-600">Gemini 2.5</span></span>
            <span class="text-gray-400">Temp: <span class="text-gray-600" id="status-temp">0.7</span></span>
            <span class="text-gray-400">Key: <span class="text-green-500 font-bold" id="key-status">Connected</span></span>
            <button class="text-gray-400 hover:text-red-500 transition-colors">Clear Data</button>
        </div>
    </div>

    <!-- MAIN WORKSPACE -->
    <main class="flex-grow px-8 lg:px-12 pb-20">
        <div class="max-w-[1600px] mx-auto grid grid-cols-1 md:grid-cols-12 gap-12 lg:gap-16 h-full items-start">
            
            <!-- LEFT COLUMN (DYNAMIC) -->
            <div class="md:col-span-5 lg:col-span-4 flex flex-col space-y-8 min-h-[600px]">
                
                <!-- 1. QUICK MODE PANEL -->
                <div id="panel-quick" class="fade-in-panel flex flex-col space-y-8 h-full">
                    <!-- Title Block: Aligned Top -->
                    <div class="mb-1">
                        <h1 class="text-2xl font-bold text-black leading-tight">Quick Mode</h1>
                        <p class="text-sm text-gray-500 mt-2">Fast prompt generation with essential controls</p>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-900 mb-3 ml-1">Tone</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="tone-btn-q px-5 py-2.5 rounded-full bg-black text-white text-sm font-medium transition-all" data-val="Standard">Standard</button>
                            <button class="tone-btn-q px-5 py-2.5 rounded-full bg-gray-50 text-gray-600 hover:bg-gray-100 text-sm font-medium transition-all" data-val="Academic">Academic</button>
                            <button class="tone-btn-q px-5 py-2.5 rounded-full bg-gray-50 text-gray-600 hover:bg-gray-100 text-sm font-medium transition-all" data-val="Creative">Creative</button>
                        </div>
                    </div>
                    <div class="flex-grow">
                        <label class="block text-xs font-bold text-gray-900 mb-3 ml-1">Context</label>
                        <textarea id="quick-context" class="w-full h-48 p-4 rounded-2xl border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-black resize-none" placeholder="Provide background information..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-900 mb-3 ml-1">Creativity Level</label>
                        <div class="bg-gray-50 rounded-full p-1.5 flex justify-between items-center">
                            <button class="flex-1 py-2 rounded-full text-sm font-medium text-gray-500">Low</button>
                            <button class="flex-1 py-2 rounded-full bg-black text-white text-sm font-medium shadow-md">Balanced</button>
                            <button class="flex-1 py-2 rounded-full text-sm font-medium text-gray-500">High</button>
                        </div>
                    </div>
                </div>

                <!-- 2. BUILDER MODE PANEL -->
                <div id="panel-builder" class="hidden fade-in-panel flex-col space-y-6 h-full">
                    <!-- Title Block: Aligned Top -->
                    <div class="mb-1">
                        <h1 class="text-2xl font-bold text-black leading-tight">Builder Mode</h1>
                        <p class="text-sm text-gray-500 mt-2">Advanced controls for precise prompt engineering</p>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between mb-2"><label class="text-xs font-bold text-gray-900">Prompt Length</label><span class="text-xs font-bold">50%</span></div>
                            <input type="range" min="0" max="100" value="50" class="w-full">
                            <div class="flex justify-between text-[10px] text-gray-400 mt-1"><span>Short</span><span>Long</span></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-2"><label class="text-xs font-bold text-gray-900">Creativity</label><span class="text-xs font-bold" id="builder-temp-val">0.7</span></div>
                            <input type="range" min="0" max="1" step="0.1" value="0.7" class="w-full" id="temp-slider">
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-900 mb-2">Number of Variations</label>
                            <input type="number" value="3" class="w-full p-3 rounded-xl border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-black">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-900 mb-2">Purpose</label>
                            <input type="text" placeholder="Describe the intended use case" class="w-full p-3 rounded-xl border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-black">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-900 mb-2">Tone</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="px-4 py-2 rounded-full bg-black text-white text-xs font-medium">Friendly</button>
                            <button class="px-4 py-2 rounded-full bg-gray-100 text-gray-600 text-xs font-medium hover:bg-gray-200">Formal</button>
                            <button class="px-4 py-2 rounded-full bg-gray-100 text-gray-600 text-xs font-medium hover:bg-gray-200">Instructive</button>
                            <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200">+</button>
                        </div>
                    </div>
                    <div class="flex-grow">
                        <label class="block text-xs font-bold text-gray-900 mb-2">Context & Constraints</label>
                        <textarea class="w-full h-32 p-4 rounded-xl border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-black resize-none" placeholder="Add specific constraints..."></textarea>
                    </div>
                </div>

                <!-- Shared Action Button -->
                <div class="pt-2 pb-6">
                    <button id="generate-btn" class="w-full py-4 bg-black text-white rounded-2xl font-bold text-base hover:bg-gray-800 transform active:scale-[0.99] transition-all flex justify-center items-center gap-2 shadow-lg">
                        Generate Prompt
                    </button>
                </div>
            </div>

            <!-- RIGHT COLUMN (PREVIEW & RESULTS) -->
            <div class="md:col-span-7 lg:col-span-8 flex flex-col space-y-8">
                
                <!-- Preview Card -->
                <div>
                    <!-- Title Block: Aligned Top with Left -->
                    <div class="mb-1 flex justify-between items-baseline">
                        <h2 class="text-2xl font-bold text-black leading-tight">Prompt Preview</h2>
                        <span id="word-count" class="text-xs text-gray-400 opacity-0 transition-opacity">0 words</span>
                    </div>
                    
                    <div class="bg-white border border-gray-200 rounded-2xl p-8 relative min-h-[320px] shadow-sm flex flex-col">
                        <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-center transition-opacity duration-300">
                            <p class="text-gray-400 text-sm">Your generated prompt will appear here.</p>
                        </div>

                        <!-- Quantum Loading -->
                        <div id="loading-state" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-10 hidden opacity-0 transition-opacity duration-300">
                            <div class="spinner mb-6"></div>
                            <div class="text-center space-y-2">
                                <p id="loading-text" class="text-sm font-bold text-gray-900 log-fade">Initializing...</p>
                                <p id="loading-subtext" class="text-xs font-mono text-gray-500 log-fade">Waiting for input</p>
                            </div>
                        </div>

                        <!-- Result -->
                        <div id="result-content" class="relative z-0 hidden opacity-0 transition-opacity duration-500">
                            <pre id="prompt-output" class="whitespace-pre-wrap font-sans text-base text-gray-800 leading-relaxed"></pre>
                        </div>
                    </div>
                </div>

                <!-- Quality Evaluation -->
                <div id="quality-section" class="hidden opacity-0 transition-opacity duration-700 delay-100">
                    <h3 class="text-lg font-bold text-black mb-4">Quality Evaluation</h3>
                    <div class="space-y-6">
                        <div><div class="flex justify-between items-end mb-2"><span class="text-sm font-medium text-gray-600">Clarity</span><span class="text-sm font-bold text-black">89%</span></div><div class="w-full bg-gray-100 rounded-full h-2"><div class="bg-black h-2 rounded-full bar-fill" style="width: 0%" data-width="89%"></div></div></div>
                        <div><div class="flex justify-between items-end mb-2"><span class="text-sm font-medium text-gray-600">Completeness</span><span class="text-sm font-bold text-black">71%</span></div><div class="w-full bg-gray-100 rounded-full h-2"><div class="bg-black h-2 rounded-full bar-fill" style="width: 0%" data-width="71%"></div></div></div>
                        <div><div class="flex justify-between items-end mb-2"><span class="text-sm font-medium text-gray-600">Consistency</span><span class="text-sm font-bold text-black">77%</span></div><div class="w-full bg-gray-100 rounded-full h-2"><div class="bg-black h-2 rounded-full bar-fill" style="width: 0%" data-width="77%"></div></div></div>
                    </div>
                </div>

                <!-- Suggestions -->
                <div id="suggestions-section" class="hidden opacity-0 transition-opacity duration-700 delay-300">
                    <h3 class="text-lg font-bold text-black mb-4">Suggestions</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-3 text-sm text-gray-700"><div class="w-1.5 h-1.5 rounded-full bg-black mt-1.5 flex-shrink-0"></div><span>Clarify task outcome and evaluation criteria</span></li>
                        <li class="flex items-start gap-3 text-sm text-gray-700"><div class="w-1.5 h-1.5 rounded-full bg-black mt-1.5 flex-shrink-0"></div><span>Add specific constraints or domain requirements</span></li>
                        <li class="flex items-start gap-3 text-sm text-gray-700"><div class="w-1.5 h-1.5 rounded-full bg-black mt-1.5 flex-shrink-0"></div><span>Align tone with target audience expectations</span></li>
                    </ul>
                </div>

                <!-- Export -->
                <div class="pt-4 border-t border-gray-100">
                    <label class="block text-xs font-bold text-gray-900 mb-3 uppercase tracking-wide">Export</label>
                    <div class="flex gap-4">
                        <button id="copy-btn" class="flex-1 py-3.5 border border-gray-200 bg-white text-gray-900 rounded-full font-semibold hover:bg-gray-50 transition-all disabled:opacity-50">Copy</button>
                        <button id="download-btn" class="flex-1 py-3.5 bg-black text-white rounded-full font-semibold hover:bg-gray-800 transition-all disabled:opacity-50 disabled:bg-gray-200 disabled:text-gray-500" disabled>Download</button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- SYSTEM LOGIC -->
    <script>
        // === 1. STATE & STORAGE MANAGEMENT (Chapter 7) ===
        let currentMode = 'quick';
        
        // Audio State Manager
        const AudioState = {
            isEnabled: false,
            init() {
                // Read from LocalStorage
                const saved = localStorage.getItem('promptcraft_sound_enabled');
                this.isEnabled = saved === 'true'; // Default false if null
                this.updateUI();
            },
            toggle() {
                this.isEnabled = !this.isEnabled;
                localStorage.setItem('promptcraft_sound_enabled', this.isEnabled);
                this.updateUI();
                if (this.isEnabled) playSound('success'); // Feedback when enabling
            },
            updateUI() {
                const toggle = document.getElementById('sound-toggle');
                const text = document.getElementById('audio-status-text');
                const dot = document.getElementById('audio-status-dot');
                const menuBtn = document.getElementById('audio-menu-btn');
                const iconOn = document.getElementById('header-icon-on');
                const iconOff = document.getElementById('header-icon-off');

                if (toggle) toggle.checked = this.isEnabled;
                
                if (this.isEnabled) {
                    text.innerText = "Active";
                    text.classList.replace('text-gray-400', 'text-green-600');
                    dot.className = "h-2 w-2 rounded-full bg-green-500 animate-pulse";
                    menuBtn.classList.remove('bg-gray-100');
                    iconOn.classList.remove('hidden');
                    iconOff.classList.add('hidden');
                } else {
                    text.innerText = "Disabled";
                    text.classList.replace('text-green-600', 'text-gray-400');
                    dot.className = "h-2 w-2 rounded-full bg-gray-300";
                    menuBtn.classList.add('bg-gray-100');
                    iconOn.classList.add('hidden');
                    iconOff.classList.remove('hidden');
                }
            }
        };

        // === 2. AUDIO ENGINE (Standard Web Audio API) ===
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            // Browser policy: Resume context
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            // Check global state
            if (!AudioState.isEnabled && type !== 'test') return;

            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'tick') {
                // Subtle processing sound (Low volume)
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, t);
                osc.frequency.exponentialRampToValueAtTime(100, t + 0.05);
                gain.gain.setValueAtTime(0.01, t); // Very quiet
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
                osc.start(t);
                osc.stop(t + 0.05);
            } 
            else if (type === 'success') {
                // Soft confirmation chord (C Major)
                const playNote = (f, d) => { 
                    const o = audioCtx.createOscillator(); 
                    const g = audioCtx.createGain(); 
                    o.type = 'sine'; o.frequency.value = f; o.connect(g); g.connect(audioCtx.destination); 
                    g.gain.setValueAtTime(0, t + d); 
                    g.gain.linearRampToValueAtTime(0.05, t + d + 0.05); 
                    g.gain.exponentialRampToValueAtTime(0.001, t + d + 0.6); 
                    o.start(t + d); o.stop(t + d + 0.6); 
                };
                playNote(523.25, 0);   // C5
                playNote(659.25, 0.1); // E5
                playNote(783.99, 0.2); // G5
            } 
            else if (type === 'error') {
                // Serious tone (Sawtooth descending)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, t);
                osc.frequency.linearRampToValueAtTime(100, t + 0.3);
                gain.gain.setValueAtTime(0.05, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.3);
                osc.start(t);
                osc.stop(t + 0.3);
            }
            else if (type === 'test') {
                // Demo sound
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, t);
                gain.gain.setValueAtTime(0.1, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.5);
                osc.start(t);
                osc.stop(t + 0.5);
            }
        }

        // === 3. UI INTERACTIONS ===
        
        // Init Audio State on Load
        window.addEventListener('load', () => AudioState.init());

        // Dropdown Logic
        const audioMenuBtn = document.getElementById('audio-menu-btn');
        const audioDropdown = document.getElementById('audio-dropdown');
        
        audioMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (audioDropdown.classList.contains('hidden')) {
                audioDropdown.classList.remove('hidden');
                audioDropdown.classList.add('dropdown-enter-active');
            } else {
                audioDropdown.classList.add('hidden');
            }
        });

        function closeDropdowns(e) {
            if (!audioMenuBtn.contains(e.target) && !audioDropdown.contains(e.target)) {
                audioDropdown.classList.add('hidden');
            }
        }

        document.getElementById('sound-toggle').addEventListener('change', () => AudioState.toggle());
        document.getElementById('test-audio-btn').addEventListener('click', () => playSound('test'));

        // Mode Switching
        const modeQuickBtn = document.getElementById('mode-quick');
        const modeBuilderBtn = document.getElementById('mode-builder');
        const panelQuick = document.getElementById('panel-quick');
        const panelBuilder = document.getElementById('panel-builder');

        function setMode(mode) {
            // Note: No sound here based on Chapter 7 "not for every action"
            currentMode = mode;
            if (mode === 'quick') {
                modeQuickBtn.className = "w-32 py-2 rounded-full bg-black text-white text-sm font-semibold shadow-sm transition-all z-10";
                modeBuilderBtn.className = "w-32 py-2 rounded-full text-gray-500 hover:text-gray-900 text-sm font-medium transition-all z-10";
                panelQuick.classList.remove('hidden');
                panelBuilder.classList.add('hidden');
            } else {
                modeQuickBtn.className = "w-32 py-2 rounded-full text-gray-500 hover:text-gray-900 text-sm font-medium transition-all z-10";
                modeBuilderBtn.className = "w-32 py-2 rounded-full bg-black text-white text-sm font-semibold shadow-sm transition-all z-10";
                panelQuick.classList.add('hidden');
                panelBuilder.classList.remove('hidden');
            }
        }

        modeQuickBtn.addEventListener('click', () => setMode('quick'));
        modeBuilderBtn.addEventListener('click', () => setMode('builder'));

        // Visual only toggles (No sound)
        document.querySelectorAll('.tone-btn-q').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tone-btn-q').forEach(b => b.className = 'tone-btn-q px-5 py-2.5 rounded-full bg-gray-50 text-gray-600 hover:bg-gray-100 text-sm font-medium transition-all');
                btn.className = 'tone-btn-q px-5 py-2.5 rounded-full bg-black text-white text-sm font-medium transition-all';
            });
        });

        document.getElementById('temp-slider').addEventListener('input', (e) => {
            document.getElementById('status-temp').innerText = e.target.value;
            document.getElementById('builder-temp-val').innerText = e.target.value;
        });

        // === 4. QUANTUM GENERATION LOGIC ===
        const generateBtn = document.getElementById('generate-btn');
        const loadingState = document.getElementById('loading-state');
        const emptyState = document.getElementById('empty-state');
        const resultContent = document.getElementById('result-content');
        const promptOutput = document.getElementById('prompt-output');
        const loadingText = document.getElementById('loading-text');
        const loadingSubText = document.getElementById('loading-subtext');
        const qualitySection = document.getElementById('quality-section');
        const suggestionsSection = document.getElementById('suggestions-section');
        const wordCount = document.getElementById('word-count');
        const downloadBtn = document.getElementById('download-btn');
        const copyBtn = document.getElementById('copy-btn');

        const quantumProcessQuick = [
            { main: "Initializing Engine...", sub: "Standard Mode" },
            { main: "Generating Variants...", sub: "Superposition: 16 States" },
            { main: "Evaluating Quality...", sub: "Clarity & Tone Analysis" },
            { main: "Finalizing...", sub: "Selecting Best Match" }
        ];

        const quantumProcessBuilder = [
            { main: "Initializing Builder...", sub: "Advanced Mode: Active" },
            { main: "Applying Constraints...", sub: "Temp: 0.7 | Length: 50%" },
            { main: "Generating Variants...", sub: "Superposition: 64 States" },
            { main: "Deep Analysis...", sub: "Scoring Multi-dimensional Metrics" },
            { main: "Optimizing...", sub: "Confidence: 98.2%" }
        ];

        generateBtn.addEventListener('click', async () => {
            // ERROR SIMULATION CHECK (If context is empty)
            const contextVal = currentMode === 'quick' ? document.getElementById('quick-context').value : "Builder Context"; 
            if(currentMode === 'quick' && !contextVal.trim()) {
                playSound('error'); // Serious error tone
                const inputArea = document.getElementById('quick-context');
                inputArea.classList.add('border-red-500', 'shake');
                inputArea.focus();
                setTimeout(() => inputArea.classList.remove('border-red-500', 'shake'), 500);
                return;
            }

            // Normal Flow
            generateBtn.disabled = true;
            generateBtn.innerText = 'Optimizing...';
            generateBtn.classList.add('opacity-75');
            emptyState.style.opacity = '0';
            resultContent.classList.add('hidden');
            
            qualitySection.classList.add('hidden', 'opacity-0');
            suggestionsSection.classList.add('hidden', 'opacity-0');
            wordCount.classList.add('opacity-0');
            document.querySelectorAll('.bar-fill').forEach(bar => bar.style.width = '0%');

            loadingState.classList.remove('hidden');
            loadingState.style.opacity = '1';

            const process = currentMode === 'quick' ? quantumProcessQuick : quantumProcessBuilder;

            // Run Simulation
            for (let i = 0; i < process.length; i++) {
                loadingText.innerText = process[i].main;
                loadingSubText.innerText = process[i].sub;
                loadingText.classList.remove('log-fade');
                void loadingText.offsetWidth; 
                loadingText.classList.add('log-fade');
                
                playSound('tick'); // Quiet processing sound
                
                await new Promise(r => setTimeout(r, 500));
            }

            const finalPrompt = currentMode === 'quick' 
                ? `[Quick Mode Result]\n\n"Act as an expert. Please analyze the context provided above. Ensure the tone is standard and professional. Focus on clarity and actionable steps."`
                : `[Builder Mode Result]\n\n"You are an expert consultant. Based on the constraints (Temp: 0.7, Length: Medium), generate a comprehensive response.\n\nRequirements:\n1. Maintain a friendly yet professional tone.\n2. Provide exactly 3 variations.\n3. Ensure high consistency with the domain constraints."\n\n[Optimized via Quantum Search]`;

            promptOutput.innerText = finalPrompt;
            wordCount.innerText = currentMode === 'quick' ? "120 words" : "340 words";

            loadingState.style.opacity = '0';
            setTimeout(() => loadingState.classList.add('hidden'), 300);
            resultContent.classList.remove('hidden');
            
            qualitySection.classList.remove('hidden');
            suggestionsSection.classList.remove('hidden');
            setTimeout(() => {
                qualitySection.classList.remove('opacity-0');
                suggestionsSection.classList.remove('opacity-0');
                wordCount.classList.remove('opacity-0');
                document.querySelectorAll('.bar-fill').forEach(bar => bar.style.width = bar.getAttribute('data-width'));
            }, 100);

            generateBtn.disabled = false;
            generateBtn.innerText = 'Generate Prompt';
            generateBtn.classList.remove('opacity-75');
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('bg-gray-200', 'text-gray-500', 'cursor-not-allowed');
            downloadBtn.classList.add('bg-black', 'text-white', 'hover:bg-gray-800');
            
            playSound('success'); // Completion tone
        });

        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(promptOutput.innerText).then(() => {
                copyBtn.innerText = "Copied!";
                copyBtn.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
                playSound('success'); // Confirmation tone
                setTimeout(() => {
                    copyBtn.innerText = originalText;
                    copyBtn.classList.remove('bg-green-50', 'text-green-700', 'border-green-200');
                }, 2000);
            });
        });
    </script>
</body>
</html>